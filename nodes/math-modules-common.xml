<?xml version="1.0" standalone="no"?>

<kickstart>

<description>
math libraries

Automatically Tuned Linear Algebra Package (ATLAS)
http://math-atlas.sourceforge.net

gsl
http://www.gnu.org/software/gsl/

LAPACK (LINEAR ALGEBRA PACKAGE)
http://www.netlib.org/lapack

octave
http://www.gnu.org/software/octave

par/metis
http://glaros.dtc.umn.edu/gkhome/views/metis

petsc
http://www.mcs.anl.gov/petsc/petsc-2/index.html

scalapack
http://www.netlib.org/scalapack

sprng 
http://sprng.cs.fsu.edu/

superlu
http://crd.lbl.gov/~xiaoye/SuperLU/

trilinos
http://trilinos.sandia.gov/
</description>

<copyright>
Copyright (c) 2000 - 2011 The Regents of the University of California.
All rights reserved. Rocks(r) v5.1 www.rocksclusters.org
</copyright>

<changelog>
</changelog>

<post>

# Remove /etc/profile.d files in favor of loadable modules when available

if test `grep -c /opt/modulefiles/applications /etc/profile.d/modules.csh` = 0; then
  echo 'setenv MODULEPATH /opt/modulefiles/applications:$MODULEPATH' >> \
       /etc/profile.d/modules.csh
fi
if test `grep -c /opt/modulefiles/applications /etc/profile.d/modules.sh` = 0; then
  echo 'export MODULEPATH=/opt/modulefiles/applications:$MODULEPATH' >> \
       /etc/profile.d/modules.sh
fi

<!-- ATLAS -->
if test -f /etc/profile.d/atlas.sh; then

  /bin/rm -f /etc/profile.d/atlas.*

  for COMPILER in `ls /opt/atlas`; do

    /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/atlas

    cat > /opt/modulefiles/applications/.$COMPILER/atlas/3.9.45 << END
#%Module1.0
prepend-path LD_LIBRARY_PATH /opt/atlas/$COMPILER/lib
prepend-path LIBPATH /opt/atlas/$COMPILER/lib
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/atlas/3.9.45

    cat > /opt/modulefiles/applications/.$COMPILER/atlas/.version.3.9.45 << END
#%Module1.0
set ModulesVersion "3.9.45"
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/atlas/.version.3.9.45

    /bin/ln -s /opt/modulefiles/applications/.$COMPILER/atlas/.version.3.9.45 \
               /opt/modulefiles/applications/.$COMPILER/atlas/.version

  done

fi

<!-- GSL -->
if test -f /etc/profile.d/gsl.sh; then

  /bin/rm -f /etc/profile.d/gsl.*

  for COMPILER in `ls /opt/gsl`; do

    /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/gsl

    cat > /opt/modulefiles/applications/.$COMPILER/gsl/1.11 << END
#%Module1.0
prepend-path PATH /opt/gsl/$COMPILER/bin
prepend-path LD_LIBRARY_PATH /opt/gsl/$COMPILER/lib
prepend-path LIBPATH /opt/gsl/$COMPILER/lib
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/gsl/1.11

    cat > /opt/modulefiles/applications/.$COMPILER/gsl/.version.1.11 << END
#%Module1.0
set ModulesVersion "1.11"
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/gsl/.version.1.11

    /bin/ln -s /opt/modulefiles/applications/.$COMPILER/gsl/.version.1.11 \
               /opt/modulefiles/applications/.$COMPILER/gsl/.version

  done

fi

<!-- LAPACK -->
if test -f /etc/profile.d/lapack.sh; then

  /bin/rm -f /etc/profile.d/lapack.*

  for COMPILER in `ls /opt/lapack`; do

    /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/lapack

    cat > /opt/modulefiles/applications/.$COMPILER/lapack/3.3.1 << END
#%Module1.0
prepend-path LD_LIBRARY_PATH /opt/lapack/$COMPILER/lib
prepend-path LIBPATH /opt/lapack/$COMPILER/lib
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/lapack/3.3.1

    cat > /opt/modulefiles/applications/.$COMPILER/lapack/.version.3.3.1 << END
#%Module1.0
set ModulesVersion "3.3.1"
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/lapack/.version.3.3.1

    /bin/ln -s /opt/modulefiles/applications/.$COMPILER/lapack/.version.3.3.1 \
               /opt/modulefiles/applications/.$COMPILER/lapack/.version

fi

<!-- OCTAVE -->
if test -f /etc/profile.d/octave.sh; then

  /bin/rm -f /etc/profile.d/octave.*

  /bin/mkdir -m 0755 -p /opt/modulefiles/applications/octave

<file name="/opt/modulefiles/applications/octave/3.4.2" perms="0644">
#%Module1.0
prepend-path PATH /opt/octave/bin
</file>

<file name="/opt/modulefiles/applications/octave/.version.3.4.2">
#%Module1.0
set ModulesVersion "3.4.2"
</file>

  /bin/ln -s /opt/modulefiles/applications/octave/.version.3.4.2 \
             /opt/modulefiles/applications/octave/.version

fi

<!-- PARMETIS -->
if test -f /etc/profile.d/parmetis.sh; then

  /bin/rm -f /etc/profile.d/parmetis.*

  for COMPILER in `ls /opt/parmetis`; do

    /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/parmetis

    cat > /opt/modulefiles/applications/.$COMPILER/parmetis/4.0.1 << END
#%Module1.0
if { ! [info exists env(MPIHOME)] } {
  puts stderr "Need to load an mpi module first"
  exit
} elseif { [string match "*mpich2*" $env(MPIHOME)] } {
  set mpiFlavor mpich2
} elseif { [string match "*mpich*" $env(MPIHOME)] } {
  set mpiFlavor mpich
} elseif { [string match "*mvapich2*" $env(MPIHOME)] } {
  set mpiFlavor mvapich2
} elseif { [string match "*openmpi*" $env(MPIHOME)] } {
  set mpiFlavor openmpi
} else {
  puts stderr "Unknown mpi $env(MPIHOME)"
  exit
}
prepend-path PATH /opt/parmetis/$COMPILER/$mpiFlavor/bin
prepend-path LD_LIBRARY_PATH /opt/parmetis/$COMPILER/$mpiFlavor/lib
prepend-path LIBPATH /opt/parmetis/$COMPILER/$mpiFlavor/lib
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/parmetis/4.0.1

    cat > /opt/modulefiles/applications/.$COMPILER/parmetis/.version.4.0.1 << END
#%Module1.0
set ModulesVersion "4.0.1"
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/parmetis/.version.4.0.1

    /bin/ln -s /opt/modulefiles/applications/.${COMPILER}/parmetis/.version.4.0.1 \
               /opt/modulefiles/applications/.${COMPILER}/parmetis/.version

  done

fi

<!-- PETSC -->
if test -f /etc/profile.d/petsc.sh; then

  /bin/rm -f /etc/profile.d/petsc.*

  for COMPILER in `ls /opt/petsc`; do

    /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/petsc

    cat > /opt/modulefiles/applications/.$COMPILER/petsc/3.2.p3 << END
#%Module1.0
if { ! [info exists env(MPIHOME)] } {
  puts stderr "Need to load an mpi module first"
  exit
} elseif { [string match "*mpich2*" $env(MPIHOME)] } {
  set mpiFlavor mpich2
} elseif { [string match "*mpich*" $env(MPIHOME)] } {
  set mpiFlavor mpich
} elseif { [string match "*mvapich2*" $env(MPIHOME)] } {
  set mpiFlavor mvapich2
} elseif { [string match "*openmpi*" $env(MPIHOME)] } {
  set mpiFlavor openmpi
} else {
  puts stderr "Unknown mpi $env(MPIHOME)"
  exit
}
prepend-path PATH /opt/petsc/$COMPILER/$mpiFlavor/bin
prepend-path LD_LIBRARY_PATH /opt/petsc/$COMPILER/$mpiFlavor/lib
prepend-path LIBPATH /opt/petsc/$COMPILER/$mpiFlavor/lib
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/petsc/3.2.p3

    cat > /opt/modulefiles/applications/.$COMPILER/petsc/.version.3.2.p3 << END
#%Module1.0
set ModulesVersion "3.2.p3"
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/petsc/.version.3.2.p3

    /bin/ln -s /opt/modulefiles/applications/.$COMPILER/petsc/.version.3.2.p3 \
               /opt/modulefiles/applications/.$COMPILER/petsc/.version

  done

fi

<!-- SCALAPACK -->
if test -f /etc/profile.d/scalapack.sh; then

  /bin/rm -f /etc/profile.d/scalapack.*

  for COMPILER in `ls /opt/scalapack`; do

    /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/scalapack

    cat > /opt/modulefiles/applications/.$COMPILER/scalapack/1.8.0 << END
#%Module1.0
if { ! [info exists env(MPIHOME)] } {
  puts stderr "Need to load an mpi module first"
  exit
} elseif { [string match "*mpich2*" $env(MPIHOME)] } {
  set mpiFlavor mpich2
} elseif { [string match "*mpich*" $env(MPIHOME)] } {
  set mpiFlavor mpich
} elseif { [string match "*mvapich2*" $env(MPIHOME)] } {
  set mpiFlavor mvapich2
} elseif { [string match "*openmpi*" $env(MPIHOME)] } {
  set mpiFlavor openmpi
} else {
  puts stderr "Unknown mpi $env(MPIHOME)"
  exit
}
prepend-path LD_LIBRARY_PATH /opt/scalapack/$COMPILER/$mpiFlavor/lib
prepend-path LIBPATH /opt/scalapack/$COMPILER/$mpiFlavor/lib
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/scalapack/1.8.0

    cat > /opt/modulefiles/applications/.$COMPILER/scalapack/.version.1.8.0 << END
#%Module1.0
set ModulesVersion "1.8.0"
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/scalapack/.version.1.8.0

    /bin/ln -s /opt/modulefiles/applications/.$COMPILER/scalapack/.version.1.8.0 \
               /opt/modulefiles/applications/.$COMPILER/scalapack/.version

  done

fi

<!-- SPRNG -->
if test -f /etc/profile.d/sprng.sh; then

  /bin/rm -f /etc/profile.d/sprng.*

  for COMPILER in `ls /opt/sprng`; do

    /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/sprng

    cat > /opt/modulefiles/applications/.$COMPILER/sprng/2.0b << END
#%Module1.0
if { ! [info exists env(MPIHOME)] } {
  puts stderr "Need to load an mpi module first"
  exit
} elseif { [string match "*mpich2*" $env(MPIHOME)] } {
  set mpiFlavor mpich2
} elseif { [string match "*mpich*" $env(MPIHOME)] } {
  set mpiFlavor mpich
} elseif { [string match "*mvapich2*" $env(MPIHOME)] } {
  set mpiFlavor mvapich2
} elseif { [string match "*openmpi*" $env(MPIHOME)] } {
  set mpiFlavor openmpi
} else {
  puts stderr "Unknown mpi $env(MPIHOME)"
  exit
}
prepend-path LD_LIBRARY_PATH /opt/sprng/$COMPILER/$mpiFlavor/lib
prepend-path LIBPATH /opt/sprng/$COMPILER/$mpiFlavor/lib
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/sprng/2.0b

    cat > /opt/modulefiles/applications/.$COMPILER/sprng/.version.2.0b << END
#%Module1.0
set ModulesVersion "2.0b"
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/sprng/.version.2.0b

    /bin/ln -s /opt/modulefiles/applications/.$COMPILER/sprng/.version.2.0b \
               /opt/modulefiles/applications/.$COMPILER/sprng/.version

  done

fi

<!-- SUPERLU -->
if test -f /etc/profile.d/superlu.sh; then

  /bin/rm -f /etc/profile.d/superlu.*

  for COMPILER in `ls /opt/superlu`; do

    /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/superlu

    cat > /opt/modulefiles/applications/.$COMPILER/superlu/2.5 << END
#%Module1.0
if { ! [info exists env(MPIHOME)] } {
  puts stderr "Need to load an mpi module first"
  exit
} elseif { [string match "*mpich2*" $env(MPIHOME)] } {
  set mpiFlavor mpich2
} elseif { [string match "*mpich*" $env(MPIHOME)] } {
  set mpiFlavor mpich
} elseif { [string match "*mvapich2*" $env(MPIHOME)] } {
  set mpiFlavor mvapich2
} elseif { [string match "*openmpi*" $env(MPIHOME)] } {
  set mpiFlavor openmpi
} else {
  puts stderr "Unknown mpi $env(MPIHOME)"
  exit
}
prepend-path LD_LIBRARY_PATH /opt/superlu/$COMPILER/$mpiFlavor/lib
prepend-path LIBPATH /opt/superlu/$COMPILER/$mpiFlavor/lib
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/superlu/2.5

    cat > /opt/modulefiles/applications/.$COMPILER/superlu/.version.2.5 << END
#%Module1.0
set ModulesVersion "2.5"
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/superlu/.version.2.5

    /bin/ln -s /opt/modulefiles/applications/.$COMPILER/superlu/.version.2.5 \
               /opt/modulefiles/applications/.$COMPILER/superlu/.version

  done

fi

<!-- TRILINOS -->
if test -f /etc/profile.d/trilinos.sh; then

  /bin/rm -f /etc/profile.d/trilinos.*

  for COMPILER in `ls /opt/trilinos`; do

    /bin/mkdir -m 0755 -p /opt/modulefiles/applications/.$COMPILER/trilinos

    cat > /opt/modulefiles/applications/.$COMPILER/trilinos/10.6.4 << END
#%Module1.0
if { ! [info exists env(MPIHOME)] } {
  puts stderr "Need to load an mpi module first"
  exit
} elseif { [string match "*mpich2*" $env(MPIHOME)] } {
  set mpiFlavor mpich2
} elseif { [string match "*mpich*" $env(MPIHOME)] } {
  set mpiFlavor mpich
} elseif { [string match "*mvapich2*" $env(MPIHOME)] } {
  set mpiFlavor mvapich2
} elseif { [string match "*openmpi*" $env(MPIHOME)] } {
  set mpiFlavor openmpi
} else {
  puts stderr "Unknown mpi $env(MPIHOME)"
  exit
}
prepend-path PATH /opt/trilinos/$COMPILER/$mpiFlavor/bin
prepend-path LD_LIBRARY_PATH /opt/trilinos/$COMPILER/$mpiFlavor/lib
prepend-path LIBPATH /opt/trilinos/$COMPILER/$mpiFlavor/lib
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/trilinos/10.6.4

    cat > /opt/modulefiles/applications/.$COMPILER/trilinos/.version.10.6.4 << END
#%Module1.0
set ModulesVersion "10.6.4"
END
    chmod 0644 /opt/modulefiles/applications/.$COMPILER/trilinos/.version.10.6.4

    /bin/ln -s /opt/modulefiles/applications/.$COMPILER/trilinos/.version.10.6.4 \
               /opt/modulefiles/applications/.$COMPILER/trilinos/.version

  done

fi

</post>

</kickstart>
